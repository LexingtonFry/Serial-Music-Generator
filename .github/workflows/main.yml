name: Build Windows EXE

on: [push]

jobs:
  build:
    runs-on: windows-latest

    steps:
    # === 修复点 1: 改为 v4 ===
    - uses: actions/checkout@v4

    # === 修复点 2: 改为 v5 ===
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.9'

    - name: Install dependencies
      run: |
        pip install music21 pyinstaller
        # 如果你用了其他库，加在这里

    - name: Build with PyInstaller
      run: |
        # 确保这里的文件名 music.py 和你上传的一致
        pyinstaller --noconfirm --onefile --windowed --name "SerialComposer" music.py

    # === 关键修复点: 改为 v4 ===
    - name: Upload EXE
      uses: actions/upload-artifact@v4
      with:
        name: My-Windows-App
        path: dist/*.exe
        # v4 版本不再默认压缩，但下载时 GitHub 会自动帮你压成 zip
